<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Weather Forecast Dashboard</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gray-100 text-gray-900">

  <div class="max-w-4xl mx-auto p-6">

    <h1 class="text-3xl font-bold mb-6 text-center">
      ðŸŒ¤ 7-Day Weather Forecast (Bangkok)
    </h1>

    <!-- TABLE -->
    <div class="bg-white shadow-lg rounded-xl p-4 mb-8">
      <h2 class="text-xl font-semibold mb-3">Forecast Table</h2>

      <div class="overflow-x-auto">
        <table id="temperatureTable" class="w-full text-center border border-gray-300 rounded-lg">
          <thead class="bg-blue-600 text-white">
            <tr>
              <th class="py-2 px-4 border">Date</th>
              <th class="py-2 px-4 border">Max Temp (Â°C)</th>
              <th class="py-2 px-4 border">Rain (mm)</th>
              <th class="py-2 px-4 border">UV Index</th>
              <th class="py-2 px-4 border">Humidity (%)</th>
            </tr>
          </thead>
          <tbody class="bg-white"></tbody>
        </table>
      </div>
    </div>

    <!-- CHART -->
    <div class="bg-white shadow-lg rounded-xl p-4">
      <h2 class="text-xl font-semibold mb-3">Temperature Chart</h2>
      <canvas id="myChart" height="120"></canvas>
    </div>

  </div>

  <!-- SCRIPT -->
  <script>
    const API_URL =
      "https://api.open-meteo.com/v1/forecast?latitude=13.75&longitude=100.5&daily=temperature_2m_max,rain_sum,uv_index_max&hourly=relative_humidity_2m&timezone=Asia/Bangkok";

    let chartInstance = null;

    async function loadWeather() {
      const res = await fetch(API_URL);
      const data = await res.json();

      const dates = data.daily.time;
      const temps = data.daily.temperature_2m_max;
      const rain = data.daily.rain_sum;
      const uv = data.daily.uv_index_max;

      const hourlyTimes = data.hourly.time;
      const hourlyHumidity = data.hourly.relative_humidity_2m;

      // ===== à¸„à¸³à¸™à¸§à¸“ Humidity à¹€à¸‰à¸¥à¸µà¹ˆà¸¢à¸£à¸²à¸¢à¸§à¸±à¸™ =====
      const humidityByDate = {};

      hourlyTimes.forEach((time, i) => {
        const date = time.split("T")[0];
        if (!humidityByDate[date]) {
          humidityByDate[date] = [];
        }
        humidityByDate[date].push(hourlyHumidity[i]);
      });

      const humidityDaily = dates.map(date => {
        const values = humidityByDate[date];
        if (!values) return "-";
        const avg = values.reduce((a, b) => a + b, 0) / values.length;
        return avg.toFixed(1);
      });

      // ===== à¹ƒà¸ªà¹ˆà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¸‡à¸•à¸²à¸£à¸²à¸‡ =====
      const tbody = document.querySelector("#temperatureTable tbody");
      tbody.innerHTML = "";

      dates.forEach((date, i) => {
        tbody.innerHTML += `
          <tr class="border-b hover:bg-gray-100">
            <td class="py-2 px-3">${date}</td>
            <td class="py-2 px-3">${temps[i]} Â°C</td>
            <td class="py-2 px-3">${rain[i]} mm</td>
            <td class="py-2 px-3">${uv[i]}</td>
            <td class="py-2 px-3">${humidityDaily[i]} %</td>
          </tr>
        `;
      });

      drawChart(dates, temps);
    }

    function drawChart(labels, temps) {
      const ctx = document.getElementById("myChart");

      if (chartInstance) chartInstance.destroy();

      chartInstance = new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "Max Temperature (Â°C)",
            data: temps,
            borderWidth: 2,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: false }
          }
        }
      });
    }

    window.onload = loadWeather;
  </script>

</body>
</html>
